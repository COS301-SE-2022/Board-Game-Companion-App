<h1 class = "text-gray-900 text-xl font-medium mb-2">Train</h1>


<div class = "training-stepper container w-full">
    <div class = "training-stepper-header row h-10">
        <div (click)="changeStep(0)" class = "training-stepper-step-header col-sm-2 py-1 h-full hover:bg-gray-400">
            <span [ngClass] = "{'active-step':step===0}" class = "number-icon text-white text-lg rounded-full w-full h-4 px-2 py-1">1</span>
            <span class = "text-lg ml-2 h-4 w-4">Load Data</span>
        </div>
        <div class = "separator col-sm-3 py-3 px-0 h-full">
            <div class = "border border-2 w-full"></div>
        </div>
        <div (click)="changeStep(1)" class = "training-stepper-step-header col-sm-2 py-1 h-full" [ngClass]="{'hover:bg-gray-400':enableArchitecture()}">
            <span  class = "text-white text-lg rounded-full w-full h-4 px-2 py-1" [ngClass]="{'bg-gray-400':!enableArchitecture(),'number-icon':enableArchitecture(),'active-step':step===1}">2</span>
            <span [ngClass]="{'text-gray-600':!enableArchitecture()}" class = "text-lg ml-2 h-4 w-4">Architecture</span>
        </div>
        <div class = "separator col-sm-3 py-3 px-0 h-full" >
            <div class = "border border-2 w-full"></div>
        </div>
        <div (click)="changeStep(2)" class = "training-stepper-step-header col-sm-2 py-1 h-full hover:bg-gray-400" [ngClass]="{'hover:bg-gray-400':enableConfigure()}">
            <span class = "text-white text-lg rounded-full w-full h-4 px-2 py-1" [ngClass]="{'bg-gray-400':!enableConfigure(),'number-icon':enableConfigure(),'active-step':step===2}">3</span>
            <span class = "text-lg ml-2 h-4 w-4" [ngClass]="{'text-gray-600':!enableConfigure()}">Configure</span>
        </div>
    </div>
    <div *ngIf = "step === 0" class = "training-stepper-content row">
        <div class="model-block w-full shadow-sm text-white p-2 mt-2">
            <div class="mb-4">
                <label for="data-partition" class="form-label font-medium"><b>Data</b></label>
                <input (change) = "loadData($event)" class="form-control border-2" type="file" id="dataFile">
            </div>
        
            <div class = "mb-4">
                <label for="data-partition" class="form-label font-medium"><b>Data Partition</b></label>
                <input (click) = "checkTrainingDataPercentage()" type="range" class="form-range" min="0" max="100" step="2" id="data-partition" [(ngModel)] = "trainingData">
                <p>Training: {{trainingData}}%</p>
                <p>Test: {{100- trainingData}}%</p>
            </div>
        
            <div class = "mb-4 row">
                <div class = "col-sm-6">
                    <label for="data-partition" class="form-label font-medium"><b>Input</b></label>
                        
                    <div class="w-full">
                        <div class="input-group relative w-full mb-4">
                            <input (keypress)="checkInputOnEnter($event)" [(ngModel)] = "inputFeature" name = "inputFeature" type="search" class="form-control relative flex-auto min-w-0 block w-full px-2 py-1 text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" placeholder="add" aria-label="add" aria-describedby="add-input">
                            <button (click) = "addInputFeature()" class="btn inline-block px-3 py-1 bg-gray-300 text-white font-medium text-xs leading-tight uppercase shadow-sm hover:shadow-sm focus:outline-none focus:ring-0 transition duration-150 ease-in-out flex items-center" type="button" id="button-addon2">
                                <i class="far fa-plus fa-2x"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class = "input-feature-display w-full bg-white h-32 shadow-sm border-2 overflow-y-scroll">
                        <div class = "hover:bg-gray-500 hover:text-white w-full h-6 text-gray-700 px-1 text-sm relative flex flex-row" *ngFor = "let feature of inputs">
                            <p>{{feature}}</p>
                            <div class = "absolute right-0 mr-2 hover:text-red-800" (click) = "removeInput(feature)">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class = "col-sm-6">
                    <label for="data-partition" class="form-label font-medium"><b>Output</b></label>
                    <div class="w-full">
                    
                    <div class="input-group relative w-full mb-4">
                            <input (keypress)="checkOutputOnEnter($event)" [(ngModel)] = "outputLabel" name = "outputLabel" type="search" class="form-control relative flex-auto min-w-0 block w-full px-2 py-1 text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" placeholder="add" aria-label="add" aria-describedby="add-input">
                            <button (click) = "addOutputFeature()" class="btn inline-block px-3 py-1 bg-gray-300 text-white font-medium text-xs leading-tight uppercase shadow-sm hover:shadow-sm focus:outline-none focus:ring-0 transition duration-150 ease-in-out flex items-center" type="button" id="addOutputFeature">
                                <i class="far fa-plus fa-2x"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class = "input-feature-display w-full bg-white h-32 shadow-sm border-2 overflow-y-scroll">
                        <div class = "hover:bg-gray-500 hover:text-white w-full h-6 text-gray-700 px-1 text-sm flex flex-row relative" *ngFor = "let feature of outputs">
                            <p>{{feature}}</p>
                            <div class = "absolute right-0 mr-2 hover:text-red-800" (click) = "removeLabel(feature)">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class = "w-full text-right mb-4">
                <button [disabled]  = "!enableArchitecture()" (click) = "analyse()" type="button" class="inline-block px-3 py-1 bg-gray-200 text-gray-700 font-medium text-xs leading-tight uppercase rounded shadow-sm hover:bg-gray-300 hover:shadow-sm focus:bg-gray-300 focus:shadow-sm focus:outline-none focus:ring-0 active:bg-gray-400 active:shadow-sm transition duration-150 ease-in-out">analyse</button>
            </div>

            <div class = "w-full display-panel bg-gray-200 h-24 shadow-sm overflow-y-scroll">
                <div class = "w-full text-green-800" *ngFor = "let message of analysis">
                    {{message}}
                </div>
            </div>
        </div>

    </div>
    <div *ngIf = "step === 1" class = "training-stepper-content row">

        <div class="model-block w-full shadow-sm text-white p-2">
            <div class="mb-4">
                <label for="data-partition" class="form-label font-medium"><b>Hidden Layers</b></label>
            </div>
        
            <div class = "row">
                <div class = "col-sm-6 flex flex-row">
                    <label for="Nodes" class="form-label font-medium">Nodes</label>
                    <input [(ngModel)] = "nodes" name = "nodes" class="form-control p-1 ml-4" type="number" min = "1" max = "200" placeholder="1" aria-label="nodes">
                </div>
                <div class = "col-sm-6 flex flex-row">
                    <label for="Activation" class="form-label font-medium">Activation</label>
                    <div class = "activation-funtion-menu ml-4">
                        <button class = "menu-btn bg-gray-300">
                            {{activation}}
                        </button>
                        <div class = "menu-content absolute">
                            <a (click)="setActivation('elu')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">elu</a>
                            <a (click)="setActivation('hardSigmoid')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">hardSigmoid</a>
                            <a (click)="setActivation('linear')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">linear</a>
                            <a (click)="setActivation('relu')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">relu</a>
                            <a (click)="setActivation('relu6')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">relu6</a>
                            <a (click)="setActivation('selu')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">selu</a>
                            <a (click)="setActivation('sigmoid')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">sigmoid</a>
                            <a (click)="setActivation('softmax')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">softmax</a>
                            <a (click)="setActivation('softplus')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">softplus</a>
                            <a (click)="setActivation('tanh')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">tanh</a>
                        </div>
                    </div>
                </div>
                <div class = "col-sm-12 text-right mt-3">
                    <button (click) = "addLayer()" type="button" class="inline-block px-3 py-1 bg-gray-200 text-gray-700 font-medium text-xs leading-tight uppercase rounded shadow-sm hover:bg-gray-300 hover:shadow-sm focus:bg-gray-300 focus:shadow-sm focus:outline-none focus:ring-0 active:bg-gray-400 active:shadow-sm transition duration-150 ease-in-out">add</button>        
                </div>
            </div>
        
            <div class = "border-2 p-1 mt-3" *ngFor = "let layer of hiddenLayers">
                <div class = "row">
                    <div class = "col-sm-4">
                        <label for="Nodes" class="form-label font-medium">Layer {{layer.index}}</label>
                    </div>
                    <div class = "col-sm-4 flex flex-row">
                        <label for="Nodes" class="form-label font-medium">Nodes</label>
                        <input [(ngModel)] = "layer.nodes" name = "nodes" class="form-control px-1 ml-4" type="number" min="1" max = "200" placeholder="1" aria-label="nodes">
                    </div>
                    <div class = "col-sm-3">
                        <div class = "activation-funtion-menu">
                            <button class = "menu-btn bg-gray-300">
                                {{layer.activation}}
                            </button>
                            <div class = "menu-content absolute">
                                <a (click)="setActivationByIndex(layer.index,'elu')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">elu</a>
                                <a (click)="setActivationByIndex(layer.index,'hardSigmoid')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">hardSigmoid</a>
                                <a (click)="setActivationByIndex(layer.index,'linear')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">linear</a>
                                <a (click)="setActivationByIndex(layer.index,'relu')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">relu</a>
                                <a (click)="setActivationByIndex(layer.index,'relu6')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">relu6</a>
                                <a (click)="setActivationByIndex(layer.index,'selu')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">selu</a>
                                <a (click)="setActivationByIndex(layer.index,'sigmoid')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">sigmoid</a>
                                <a (click)="setActivationByIndex(layer.index,'softmax')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">softmax</a>
                                <a (click)="setActivationByIndex(layer.index,'softplus')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">softplus</a>
                                <a (click)="setActivationByIndex(layer.index,'tanh')" class = "bg-gray-400 text-xs py-1 px-2 hover:bg-green-600">tanh</a>
                            </div>
                        </div>
                    </div>
                    <div class = "col-sm-1 text-right">
                        <div (click) = "removeLayer(layer)" class = "w-6 h-full hover:bg-red-700 text-white rounded-sm bg-red-800 p-1">
                            <i class="fas fa-times fa-xl"></i>
                        </div>
                    </div>
                </div>    
            </div>
        </div>


    </div>
    <div *ngIf = "step === 2" class = "training-stepper-content row">
        <div class="model-block w-full shadow-sm text-white p-2">
            <div class = "mb-4">
                <label for="data-partition" class="form-label font-medium"><b>Optimizer</b></label>
                <div class = "row p-2">
                    <div class = "col-sm-4" style="border-right:1px solid white">
                        <div class="form-check">
                            <input (click)="setOptimizer(0)" [checked] = "optimizer === 0" class="form-check-input" type="radio" name="adadelta" id="adadelta">
                            <label class="form-check-label" for="adadelta">
                                adadelta
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input (click)="setOptimizer(1)" [checked] = "optimizer === 1" class ="form-check-input" type="radio" name="adagrad" id="adagrad">
                            <label class="form-check-label" for="adagrad">
                                adagrad
                            </label>
                        </div>

                        <div class="form-check">
                            <input (click)="setOptimizer(2)" [checked] = "optimizer === 2" class="form-check-input" type="radio" name="adam" id="adam">
                            <label class="form-check-label" for="adam">
                                adam
                            </label>
                        </div>

                        <div class="form-check">
                            <input (click)="setOptimizer(3)" [checked] = "optimizer === 3" class="form-check-input" type="radio" name="adamax" id="adamax">
                            <label class="form-check-label" for="adamax">
                                adamax
                            </label>
                        </div>

                        <div class="form-check">
                            <input (click)="setOptimizer(4)" [checked] = "optimizer === 4" class="form-check-input" type="radio" name="momentum" id="momentum">
                            <label class="form-check-label" for="momentum">
                                momentum
                            </label>
                        </div>

                        <div class="form-check">
                            <input (click)="setOptimizer(5)" [checked] = "optimizer === 5" class="form-check-input" type="radio" name="rmsprop" id="rmsprop">
                            <label class="form-check-label" for="rmsprop">
                                rmsprop
                            </label>
                        </div>

                        <div class="form-check">
                            <input (click)="setOptimizer(6)" [checked] = "optimizer === 6" class="form-check-input" type="radio" name="sgd" id="sgd">
                            <label class="form-check-label" for="sgd">
                                sgd
                            </label>
                        </div>

                        
                    </div>
                    <div class = "col-sm-8">

                        <div id = "momentum" class = "row" *ngIf = "optimizer === 0">
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Learning rate </label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "learningRate" name = "learningRate" id="learningRate" placeholder="Learnings rate">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Decay rate</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "rho" name = "rho" id="rho" placeholder="Decay rate">
                                </div>
                            </div>
                        </div>

                        <div id = "momentum" class = "row" *ngIf = "optimizer === 1">
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Learning rate <strong>*</strong></label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "learningRate" name = "learningRate" id="learningRate" placeholder="Learnings rate">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Initial Accumulator Value</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "initialAccumulatorValue" name = "initialAccumulatorValue" id="initialAccumulatorValue" placeholder="Initial Accumulator Value">
                                </div>
                            </div>
                        </div>

                        <div id = "adamax" class = "row" *ngIf = "optimizer === 3 || optimizer === 2">
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Learning rate</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "learningRate" name = "learningRate" id="learningRate" placeholder="Learnings rate">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Decay</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [ngModel] = "decay" name = "decay" id="decay" placeholder="Decay">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Epsilon</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "epsilon" name = "epsilon" id="epsilon" placeholder="Epsilon">
                                </div>
                            </div>
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Beta 1</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [ngModel] = "beta1" name="beta1" id="beta1" placeholder="Beta1">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Beta2</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [ngModel] = "beta2" name="beta2" id="Beta2" placeholder="Beta2">
                                </div>
                            </div>
                        </div>

                        <div id = "momentum" class = "row" *ngIf = "optimizer === 4">
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Learning rate <strong>*</strong></label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "learningRate" name = "learningRate" id="learningRate" placeholder="Learnings rate">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Momentum <strong>*</strong></label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "momentum" name = "momentum" id="momentum" placeholder="Momentum">
                                </div>
                                <div class="form-check">
                                    <input [(ngModel)] = "useNesterov" class="form-check-input" type="checkbox" name="useNesterov" id="useNesterov" [checked] = "useNesterov">
                                    <label class="form-check-label" for="Centered">
                                        UseNesterov
                                    </label>
                                </div>
                            </div>
                        </div>


                        <div id = "rmsprop" class = "row" *ngIf = "optimizer === 5">
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Learning rate <strong>*</strong></label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "learningRate" name = "learningRate" id="learningRate" placeholder="Learnings rate">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Decay</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [ngModel] = "decay" name = "decay" id="decay" placeholder="Decay">
                                </div>
                            </div>
                            <div class = "col-sm-6">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Momentum</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "momentum" name = "momentum" id="momentum" placeholder="Momentum">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Epsilon</label>
                                    <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "epsilon" name = "epsilon" id="epsilon" placeholder="Epsilon">
                                </div>
                            </div>
                            
                            <div class = "col-sm-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" [(ngModel)] = "centered" name = "centered" id="centered">
                                    <label class="form-check-label" for="Centered">
                                        Centered
                                    </label>
                                </div>
                            </div>

                        </div>

                        <div id = "sgd" *ngIf = "optimizer === 6">
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Learning rate <strong>*</strong></label>
                                <input type="text" class="form-control p-1 border-2 w-32 text-sm" [(ngModel)] = "learningRate" name = "learningRate" id="learningRate" placeholder="Learnings rate">
                            </div>
                        </div>
                    </div>
                </div>

                <div class = "w-full mt-4">
                    <div class="mb-3">
                        <label for="exampleFormControlInput1" class="form-label"><b>Neural network name</b></label>
                        <input type="text" class="form-control p-1 border-2 w-60 text-sm" [(ngModel)] = "name" name = "name" id="name" placeholder="name">
                    </div>
                </div>

                <div class = "w-full mt-4">
                    <div class="mb-3">
                        <label for="exampleFormControlInput1" class="form-label"><b>Epochs</b></label>
                        <input type="number" class="form-control p-1 border-2 w-60 text-sm" [(ngModel)] = "epochs" name = "epochs" id="epochs" min = "0" placeholder="epochs">
                    </div>
                </div>
                
                <div class = "w-full mt-4 text-center">    
                    <button (click)="train()" [disabled]  = "!enableArchitecture()" type="button" class="w-1/2 inline-block px-3 py-2 bg-gray-200 text-gray-700 font-medium text-xs leading-tight uppercase rounded shadow-sm hover:bg-gray-300 hover:shadow-sm focus:bg-gray-300 focus:shadow-sm focus:outline-none focus:ring-0 active:bg-gray-400 active:shadow-sm transition duration-150 ease-in-out">
                        <i class="fas fa-cog"></i>
                        train
                    </button>
                </div>

                <div class = "w-full mt-4 display-panel bg-gray-200 h-24 shadow-sm overflow-y-scroll">
                    <div class = "w-full text-green-800" *ngFor = "let message of trainMessage">
                        {{message}}
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
